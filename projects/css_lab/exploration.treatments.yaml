templates:
  - templateName: topicPrompt
    templateContent:
      type: prompt
      name: "${topicName}_presurvey"
      file: "shared/procon/${topicName}_survey.md"
      analysisRole: predictor

  - templateName: introSequence
    templateDesc: generic presurvey
    templateContent:
      name: "wave_${waveNumber}"
      introSteps:
        - name: Political Leanings Survey
          elements:
            - type: survey
              surveyName: PoliticalPartyUS
              analysisRole: predictor

        - name: Feeling Thermometer Pretest
          note: 2 questions
          elements:
            - type: survey
              name: feelingThermometerPretest
              surveyName: PartisanFeelingThermometerUS # asks about both parties
              analysisRole: predictor

        - name: Trait Ratings Pretest
          note: 8 questions
          elements:
            - type: prompt
              file: projects/css_lab/consider_democrats.md
              conditions:
                - reference: survey.politicalPartyUS.result.normPosition
                  comparator: isAbove
                  value: 0.5
            - type: prompt
              file: projects/css_lab/consider_republicans.md
              conditions:
                - reference: survey.politicalPartyUS.result.normPosition
                  comparator: isAtMost # we haven't screened true independents yet, so have to give them something to answer?
                  value: 0.5
            - type: survey
              surveyName: TraitRatings
              analysisRole: predictor

        - name: Ten Item Personality Inventory
          elements:
            - type: survey
              surveyName: TIPI
              analysisRole: predictor

        - name: Reading the mind in the eyes
          elements:
            - type: survey
              surveyName: RmeTen
              analysisRole: predictor

        - name: Topic Presurvey
          elements:
            - type: prompt
              file: projects/css_lab/presurvey_instructions.md

            - template: topicPrompt
              broadcast:
                d0: ${topicNames}

            - type: submitButton

        - name: Demographic Survey
          elements:
            - type: survey
              surveyName: DemographicsShortUS
              analysisRole: predictor

  - templateName: crossPartisanDiscussion
    templateDesc: for measuring the effect of topic on cross-party discussion outcomes
    templateContent:
      name: "wave_${waveNumber}_topic_${topicName}_demPosition_${demPosition}_repPosition_${repPosition}"
      playerCount: 2
      groupComposition:
        - position: 0
          title: "Democrat"
          conditions:
            - reference: survey.politicalPartyUS.result.normPosition
              comparator: isBelow
              value: 0.5
            - reference: prompt.${topicName}_presurvey
              comparator: includes
              value: ${demPosition} # "yes" or "no"

        - position: 1
          title: "Republican"
          conditions:
            - reference: survey.politicalPartyUS.result.normPosition
              comparator: isAbove
              value: 0.5
            - reference: prompt.${topicName}_presurvey
              comparator: includes
              value: ${repPosition} # "yes" or "no"

      gameStages:
        - name: Attitude Attributes
          duration: 300
          elements:
            - type: prompt
              file: projects/css_lab/attitude_attribute_instructions_A.md
            - type: prompt
              file: "shared/procon/${topicName}_discussion.md"
            - type: display
              promptName: ${topicName}_presurvey
              position: player
            - type: prompt
            - file: projects/css_lab/attitude_attribute_instructions_B.md
            - type: survey
              surveyName: AttitudeAttributes

        - name: Pre-Discussion instructions
          duration: 45
          elements:
            - type: prompt
              file: projects/css_lab/pre_discussion_instructions.md
            - type: submitButton
              buttonText: Begin Discussion

        - name: Discussion
          duration: 660
          discussion:
            chatType: video
            showNickname: true
            showTitle: false
          elements:
            - type: prompt
              file: projects/css_lab/discussion_instructions.md
              hideTime: 600
            - type: prompt
              file: "shared/procon/${topicName}_discussion.md"
              hideTime: 600

            - type: prompt
              file: projects/css_lab/discussion_wrapup.md
              displayTime: 600
            - type: submitButton
              buttonText: End the call and proceed to surveys
              displayTime:
            - type: audio
              file: shared/airplane_chime.mp3
              displayTime: 600

      exitSequence:
        - name: Post-Discussion Instructions
          elements:
            - type: prompt
              surveyName: PostDiscussion
            - type: submitButton
              buttonText: Proceed to Survey

        - name: Manipulation Check
          note: 2 questions
          elements:
            - type: prompt
              file: projects/css_lab/guess_partner_party.md
              name: guessPartnerParty
              analysisRole: outcome
            - type: prompt
              file: projects/css_lab/guess_partner_position.md
            - type: prompt
              file: "shared/procon/${topicName}_survey.md"
              name: guessPartnerPosition
              analysisRole: outcome
            - type: submitButton

        - name: Attitude Change
          note: 1 question
          elements:
            - type: prompt
              file: projects/css_lab/attitude_change_instructions.md
            - type: prompt
              name: discussionTopicPostAttitude
              file: "shared/procon/${topicName}_survey.md"
              analysisRole: outcome
            - type: submitButton

        - name: Discussion general perception
          note: 9 questions
          elements:
            - type: survey
              surveyName: DiscussionGeneral
              analysisRole: outcome

        - name: Perception of Partner
          note: 8 questions
          elements:
            - type: prompt
              file: projects/css_lab/consider_partner.md
            - type: survey
              surveyName: PerceptionOfOthers
              analysisRole: outcome

        - name: Feeling Thermometer
          note: 2 questions
          elements:
            - type: survey
              name: feelingThermometerPosttest
              surveyName: PartisanFeelingThermometerUS # asks about both parties
              analysisRole: outcome

        - name: Trait Ratings
          note: 8 questions
          elements:
            - type: prompt
              file: projects/css_lab/consider_democrats.md
              showToPositions: [1]
            - type: prompt
              file: projects/css_lab/consider_republicans.md
              showToPositions: [0]
            - type: survey
              surveyName: TraitRatings
              analysisRole: outcome

        - name: MetaDiscursive
          elements:
            - type: survey
              surveyName: MetaDiscursive
              analysisRole: outcome

introSequences:
  - template: introSequence
    fields:
      waveNumber: 1
      topicNames:
        - topicName: placeholder1
        - topicName: placeholder2
        - topicName: placeholder3
        - topicName: placeholder4
        - topicName: placeholder5
        - topicName: placeholder6
        - topicName: placeholder7
        - topicName: placeholder8
        - topicName: placeholder9
        - topicName: placeholder10

  - template: introSequence
    fields:
      waveNumber: 2
      topicNames:
        - topicName: placeholder6
        - topicName: placeholder7
        - topicName: placeholder8
        - topicName: placeholder9
        - topicName: placeholder10
        - topicName: placeholder11
        - topicName: placeholder12
        - topicName: placeholder13
        - topicName: placeholder14
        - topicName: placeholder15

treatments:
  - template: crossPartisanDiscussion
    fields:
      waveNumber: 1
    broadcast:
      d0:
        - demPosition: yes
        - demPosition: no
      d1:
        - repPosition: yes
        - repPosition: no
      d2:
        - topicName: placeholder1
        - topicName: placeholder2
        - topicName: placeholder3
        - topicName: placeholder4
        - topicName: placeholder5

  - template: crossPartisanDiscussion
    fields:
      waveNumber: 2
    broadcast:
      d0:
        - demPosition: yes
        - demPosition: no
      d1:
        - repPosition: yes
        - repPosition: no
      d2:
        - topicName: placeholder1
        - topicName: placeholder2
        - topicName: placeholder3
        - topicName: placeholder4
        - topicName: placeholder5
