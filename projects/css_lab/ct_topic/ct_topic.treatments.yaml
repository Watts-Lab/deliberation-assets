templates:
  - templateName: topicPrompt
    templateContent:
      type: prompt
      name: "${topicName}_presurvey"
      file: "shared/yesNo/${topicName}_survey.md"
      analysisRole: predictor

  - templateName: introSequence
    templateDesc: generic presurvey
    templateContent:
      name: ${sequenceName}
      introSteps:
        - name: Political Leanings Survey
          elements:
            - type: survey
              surveyName: PoliticalPartyUS
              name: partyAffiliation
              analysisRole: predictor

        - name: Feeling Thermometer Pretest
          note: 2 questions
          elements:
            - type: survey
              name: feelingThermometerPretest
              surveyName: PartisanFeelingThermometerUS # asks about both parties
              analysisRole: predictor

        - name: Trait Ratings Pretest
          note: 8 questions
          elements:
            - type: prompt
              file: projects/css_lab/ct_topic/consider_democrats.md
              conditions:
                - reference: survey.partyAffiliation.result.normPosition
                  comparator: isAbove
                  value: 0.5
            - type: prompt
              file: projects/css_lab/ct_topic/consider_republicans.md
              conditions:
                - reference: survey.partyAffiliation.result.normPosition
                  comparator: isAtMost # we haven't screened true independents yet, so have them rate republicans?
                  value: 0.5
            - type: survey
              surveyName: TraitRatings
              analysisRole: predictor

        - name: Big-5 Personality Inventory
          note: 10 questions
          elements:
            - type: survey
              surveyName: TIPI
              analysisRole: predictor

        - name: Reading the mind in the eyes
          elements:
            - type: survey
              surveyName: RmeTen
              analysisRole: predictor

        - name: Topic PreSurvey
          elements:
            - type: prompt
              file: projects/css_lab/ct_topic/presurvey_instructions.md

            - template: topicPrompt
              broadcast:
                d0: ${topicNames}

            - type: submitButton

        - name: Demographic Survey
          elements:
            - type: survey
              surveyName: DemographicsShortUS
              analysisRole: predictor

  - templateName: crossPartisanDiscussion
    templateDesc: for measuring the effect of topic on cross-party discussion outcomes
    templateContent:
      name: ${treatmentName}
      playerCount: 2
      groupComposition:
        - position: 0
          title: "Democrat"
          conditions:
            - reference: survey.partyAffiliation.result.normPosition
              comparator: isBelow
              value: 0.5
            - reference: prompt.${topicName}_presurvey
              comparator: equals
              value: ${demPosition}

        - position: 1
          title: "Republican"
          conditions:
            - reference: survey.partyAffiliation.result.normPosition
              comparator: isAbove
              value: 0.5
            - reference: prompt.${topicName}_presurvey
              comparator: equals
              value: ${repPosition}

      gameStages:
        - name: Attitude Attributes
          duration: 300
          elements:
            - type: prompt
              file: projects/css_lab/ct_topic/attitude_attribute_instructions_A.md
            - type: prompt
              file: "shared/yesNo/${topicName}_discussion.md"
            - type: display
              promptName: ${topicName}_presurvey
              position: player
            - file: projects/css_lab/ct_topic/attitude_attribute_instructions_B.md
            - type: survey
              surveyName: AttitudeAttributes

        - name: Pre-Discussion instructions
          duration: 45
          elements:
            - type: prompt
              file: projects/css_lab/ct_topic/pre_discussion_instructions_democrat.md
              showToPositions: [0]
            - type: prompt
              file: projects/css_lab/ct_topic/pre_discussion_instructions_republican.md
              showToPositions: [1]
            - type: submitButton
              buttonText: Begin Discussion

        - name: Discussion
          duration: 900
          discussion:
            chatType: video
            showNickname: true
            showTitle: false
          elements:
            - type: prompt
              file: projects/css_lab/ct_topic/discussion_instructions.md
            - type: prompt
              file: "shared/yesNo/${topicName}_discussion.md"
            - type: prompt
              file: projects/css_lab/ct_topic/discussion_wrapup.md
              displayTime: 600
            - type: submitButton
              buttonText: End the call and proceed to surveys
              displayTime: 600

      exitSequence:
        - name: Post-Discussion Instructions
          elements:
            - type: prompt
              file: projects/css_lab/ct_topic/post_discussion_instructions.md
            - type: submitButton
              buttonText: Proceed to Survey

        - name: Attitude Change
          note: 1 question
          elements:
            - type: prompt
              file: projects/css_lab/ct_topic/attitude_change_instructions.md
            - type: prompt
              name: discussionTopicPostAttitude
              file: "shared/yesNo/${topicName}_survey.md"
              analysisRole: outcome
            - type: submitButton

        - name: Manipulation Check
          note: 2 questions
          elements:
            - type: prompt
              file: projects/css_lab/ct_topic/guess_partner_party.md
              name: guessPartnerParty
              analysisRole: outcome
            - type: prompt
              file: projects/css_lab/ct_topic/guess_partner_position.md
            - type: prompt
              file: "shared/yesNo/${topicName}_survey.md"
              name: guessPartnerPosition
              analysisRole: outcome
            - type: submitButton

        - name: Discussion general perception
          note: 9 questions
          elements:
            - type: survey
              surveyName: DiscussionGeneral
              analysisRole: outcome

        - name: Perception of Partner
          note: 8 questions
          elements:
            - type: prompt
              file: projects/css_lab/ct_topic/consider_partner.md
            - type: survey
              surveyName: PerceptionOfOthers
              analysisRole: outcome

        - name: Feeling Thermometer
          note: 2 questions
          elements:
            - type: survey
              name: feelingThermometerPosttest
              surveyName: PartisanFeelingThermometerUS # asks about both parties
              analysisRole: outcome

        - name: Trait Ratings
          note: 8 questions
          elements:
            - type: prompt
              file: projects/css_lab/ct_topic/consider_democrats.md
              showToPositions: [1]
            - type: prompt
              file: projects/css_lab/ct_topic/consider_republicans.md
              showToPositions: [0]
            - type: survey
              surveyName: TraitRatings
              analysisRole: outcome

        - name: Bipartisanship
          note: 3 questions
          elements:
            - type: survey
              surveyName: BipartisanshipUS
              analysisRole: outcome

        - name: MetaDiscursive
          note: 3 questions
          elements:
            - type: survey
              surveyName: MetaDiscursive
              analysisRole: outcome

introSequences:
  - template: introSequence
    fields:
      sequenceName: wave1
      topicNames:
        - topicName: fundNeedleExchange
        - topicName: israelAid
        - topicName: slaveReparations
        - topicName: universalIncome
        - topicName: schoolDressCode
        - topicName: freeInternet
        - topicName: gunControl
        - topicName: abortionLegality
        - topicName: teacherTenure
        - topicName: reduceMilitaryBudget

  - template: introSequence
    fields:
      sequenceName: wave2
      topicNames:
        - topicName: freeInternet
        - topicName: gunControl
        - topicName: abortionLegality
        - topicName: teacherTenure
        - topicName: reduceMilitaryBudget
        - topicName: prisonerVoting
        - topicName: altMedInsurance
        - topicName: wealthTax
        - topicName: birthrightCitizenship
        - topicName: banWeaponsExport

  - template: introSequence
    fields:
      sequenceName: wave3
      topicNames:
        - topicName: prisonerVoting
        - topicName: altMedInsurance
        - topicName: wealthTax
        - topicName: birthrightCitizenship
        - topicName: banWeaponsExport
        - topicName: athleteAnthem
        - topicName: ukraineAid
        - topicName: banJobExport
        - topicName: fundArtsCulture
        - topicName: immigrantCitizenship

  - template: introSequence
    fields:
      sequenceName: wave4
      topicNames:
        - topicName: athleteAnthem
        - topicName: ukraineAid
        - topicName: banJobExport
        - topicName: fundArtsCulture
        - topicName: immigrantCitizenship
        - topicName: puertoRicoStatehood
        - topicName: childcareSubsidy
        - topicName: carbonTax
        - topicName: fastFoodHealth
        - topicName: limitExecPay

  - template: introSequence
    fields:
      sequenceName: wave5
      topicNames:
        - topicName: puertoRicoStatehood
        - topicName: childcareSubsidy
        - topicName: carbonTax
        - topicName: fastFoodHealth
        - topicName: limitExecPay
        - topicName: fundNeedleExchange
        - topicName: israelAid
        - topicName: slaveReparations
        - topicName: universalIncome
        - topicName: schoolDressCode

treatments:
  - template: crossPartisanDiscussion
    fields:
      waveNumber: 1
      treatmentName: "wave_1_${topicName}_dem_${d0}_rep_${d1}"
    broadcast:
      d0:
        - demPosition: Strongly No
        - demPosition: Mostly No
        - demPosition: Slightly No
        - demPosition: Neutral
        - demPosition: Slightly Yes
        - demPosition: Mostly Yes
        - demPosition: Strongly Yes
      d1:
        - repPosition: Strongly No
        - repPosition: Mostly No
        - repPosition: Slightly No
        - repPosition: Neutral
        - repPosition: Slightly Yes
        - repPosition: Mostly Yes
        - repPosition: Strongly Yes
      d2:
        - topicName: fundNeedleExchange
        - topicName: israelAid
        - topicName: slaveReparations
        - topicName: universalIncome
        - topicName: schoolDressCode

  - template: crossPartisanDiscussion
    fields:
      waveNumber: 2
      treatmentName: "wave_2_${topicName}_dem_${d0}_rep_${d1}"
    broadcast:
      d0:
        - demPosition: Strongly No
        - demPosition: Mostly No
        - demPosition: Slightly No
        - demPosition: Neutral
        - demPosition: Slightly Yes
        - demPosition: Mostly Yes
        - demPosition: Strongly Yes
      d1:
        - repPosition: Strongly No
        - repPosition: Mostly No
        - repPosition: Slightly No
        - repPosition: Neutral
        - repPosition: Slightly Yes
        - repPosition: Mostly Yes
        - repPosition: Strongly Yes
      d2:
        - topicName: freeInternet
        - topicName: gunControl
        - topicName: abortionLegality
        - topicName: teacherTenure
        - topicName: reduceMilitaryBudget

  - template: crossPartisanDiscussion
    fields:
      waveNumber: 3
      treatmentName: "wave_3_${topicName}_dem_${d0}_rep_${d1}"
    broadcast:
      d0:
        - demPosition: Strongly No
        - demPosition: Mostly No
        - demPosition: Slightly No
        - demPosition: Neutral
        - demPosition: Slightly Yes
        - demPosition: Mostly Yes
        - demPosition: Strongly Yes
      d1:
        - repPosition: Strongly No
        - repPosition: Mostly No
        - repPosition: Slightly No
        - repPosition: Neutral
        - repPosition: Slightly Yes
        - repPosition: Mostly Yes
        - repPosition: Strongly Yes
      d2:
        - topicName: prisonerVoting
        - topicName: altMedInsurance
        - topicName: wealthTax
        - topicName: birthrightCitizenship
        - topicName: banWeaponsExport

  - template: crossPartisanDiscussion
    fields:
      waveNumber: 4
      treatmentName: "wave_4_${topicName}_dem_${d0}_rep_${d1}"
    broadcast:
      d0:
        - demPosition: Strongly No
        - demPosition: Mostly No
        - demPosition: Slightly No
        - demPosition: Neutral
        - demPosition: Slightly Yes
        - demPosition: Mostly Yes
        - demPosition: Strongly Yes
      d1:
        - repPosition: Strongly No
        - repPosition: Mostly No
        - repPosition: Slightly No
        - repPosition: Neutral
        - repPosition: Slightly Yes
        - repPosition: Mostly Yes
        - repPosition: Strongly Yes
      d2:
        - topicName: athleteAnthem
        - topicName: ukraineAid
        - topicName: banJobExport
        - topicName: fundArtsCulture
        - topicName: immigrantCitizenship

  - template: crossPartisanDiscussion
    fields:
      waveNumber: 5
      treatmentName: "wave_5_${topicName}_dem_${d0}_rep_${d1}"
    broadcast:
      d0:
        - demPosition: Strongly No
        - demPosition: Mostly No
        - demPosition: Slightly No
        - demPosition: Neutral
        - demPosition: Slightly Yes
        - demPosition: Mostly Yes
        - demPosition: Strongly Yes
      d1:
        - repPosition: Strongly No
        - repPosition: Mostly No
        - repPosition: Slightly No
        - repPosition: Neutral
        - repPosition: Slightly Yes
        - repPosition: Mostly Yes
        - repPosition: Strongly Yes
      d2:
        - topicName: puertoRicoStatehood
        - topicName: childcareSubsidy
        - topicName: carbonTax
        - topicName: fastFoodHealth
        - topicName: limitExecPay
